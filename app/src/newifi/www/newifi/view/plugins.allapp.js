L.ui.view.extend({renderInstallState:function(h,f){var e;function g(a){L.xapi.appInstallStatus(a).then(function(b){switch(b.install_status.status){case 0:var c=new L.cbi.Modal("system",{bodyText:L.tr("app-install-success-validation"),});c.show();setTimeout(function(){L.ui.popDialog(false);f(h)},5000);clearInterval(e);break;case 1:case 4:var c=new L.cbi.Modal("system",{title:L.tr("prompt-message"),footer:"ready",bodyText:L.tr("应用校验失败"),goingOn:function(){L.ui.popDialog(false);return},});c.show();clearInterval(e);break;case 2:var c=new L.cbi.Modal("system",{title:L.tr("prompt-message"),footer:"double",btnF:"cancel",btnL:L.tr("retry"),pluginCenter:["usb-disk-not-have-validation0","usb-disk-not-have-validation1","usb-disk-not-have-validation2","usb-disk-not-have-validation3","usb-disk-not-have-validation4"],goingOn:function(){self.appUpgrade(h,f)},stopGoing:function(){L.ui.popDialog(false);return},});c.show();clearInterval(e);break;case 3:var c=new L.cbi.Modal("system",{title:L.tr("prompt-message"),footer:"ready",bodyText:L.tr("usb-disk-full-validation"),goingOn:function(){L.ui.popDialog(false);return},});c.show();clearInterval(e);break;case 7:case 8:break;case 9:var c=new L.cbi.Modal("system",{title:L.tr("prompt-message"),footer:"ready",bodyText:L.tr("磁盘只读"),goingOn:function(){L.ui.popDialog(false);return},});c.show();clearInterval(e);break;case 5:case 6:default:var c=new L.cbi.Modal("system",{title:L.tr("prompt-message"),footer:"ready",bodyText:L.tr("app-download-fail-validation"),goingOn:function(){L.ui.popDialog(false);return},});c.show();clearInterval(e)}})}g(h.appid);e=setInterval(function(){g(h.appid)},5000);timeInterval.push(e)},appUpgrade:function(g,f){var e=this;var h=new L.cbi.Modal("system",{bodyText:L.tr("app-download-now-validation"),iconType:"icon-refresh"});h.show();L.xapi.appUpdate(g.appid,g.url).then(function(b){switch(b.status){case 0:var a=new L.cbi.Modal("system",{bodyText:L.tr("app-install-now-validation"),iconType:"icon-refresh"});a.show();e.renderInstallState(g,f);break;case 2:var a=new L.cbi.Modal("system",{title:L.tr("prompt-message"),footer:"double",btnF:"cancel",btnL:L.tr("retry"),pluginCenter:[L.tr("usb-disk-not-have-validation0"),L.tr("usb-disk-not-have-validation1"),L.tr("usb-disk-not-have-validation2"),L.tr("usb-disk-not-have-validation3"),L.tr("usb-disk-not-have-validation4")],goingOn:function(){e.appUpgrade(g,f)},stopGoing:function(){L.ui.popDialog(false);return},});a.show();break;case 3:var a=new L.cbi.Modal("system",{title:L.tr("prompt-message"),footer:"ready",bodyText:L.tr("usb-disk-full-validation"),goingOn:function(){L.ui.popDialog(false);return},});a.show();break;case 9:var a=new L.cbi.Modal("system",{title:L.tr("prompt-message"),footer:"ready",bodyText:L.tr("磁盘只读"),goingOn:function(){L.ui.popDialog(false);return},});a.show();break;case 100:var a=new L.cbi.Modal("system",{title:L.tr("prompt-message"),footer:"ready",bodyText:L.tr("服务器繁忙，请稍后再试……"),goingOn:function(){L.ui.popDialog(false);return},});a.show();break;case 1:default:var a=new L.cbi.Modal("system",{title:L.tr("prompt-message"),footer:"ready",bodyText:L.tr("应用下载失败，请稍候再试……"),goingOn:function(){L.ui.popDialog(false);return},});a.show()}})},appUninstall:function(c){var d=new L.cbi.Modal("system",{bodyText:L.tr("app-uninstall-now-validation"),iconType:"icon-refresh"});d.show();setTimeout(function(){L.xapi.appUninstall(c.plugin_ID).then(function(b){switch(b.status){case 0:var a=new L.cbi.Modal("system",{bodyText:L.tr("app-uninstall-success-validation"),});a.show();$("#plugin_detail").hide();$("#plugin_modal").hide();$("body").attr({style:"overflow: auto"});setTimeout(function(){L.ui.popDialog(false);top.location.reload()},3000);break;default:var a=new L.cbi.Modal("system",{title:L.tr("prompt-message"),footer:"ready",bodyText:L.tr("app-uninstall-fail-validation"),goingOn:function(){L.ui.popDialog(false);return},});a.show()}})},1000)},pendPage:function(c){var d=this;$("#plugin_modal").show();$("body").attr({style:"overflow: hidden"});L.xapi.getAppInfo(c.appid).then(function(b){var r=b.appinfo;var v=r.plugin_Name;var t=r.plugin_Author;var x=r.plugin_VersionName;var z=r.plugin_Info.split("\n");var A=r.plugin_Largeicon+"large.jpg";var y=r.plugin_Officeapp;var m=r.plugin_InstallDate.split("_");var s=m[0]+" "+m[1];var w=r.plugin_html;var a=parseInt(r.plugin_Space);for(;Math.floor(a/1024);i++){a=a/1024}a=a.toFixed(2);var u=new L.cbi.Detail("test",{pluginSection:L.tr("viewmenu-title-allapp"),isExist:false,isInstall:true,isLatest:true,isSet:w==""?false:true,imgUrl:A,setUrl:w,appData:z,pluginData:{title:v,basicInfo:[{name:L.tr("app-size"),value:a},{name:L.tr("app-model"),value:x},{name:L.tr("app-install-time"),value:s}],detailsInfo:[{name:L.tr("app-developer"),value:t}]},handleInstall:function(e){},handleUpdate:function(){},handleUninstall:function(){var e=new L.cbi.Modal("system",{title:L.tr("prompt-message"),footer:"double",btnF:"cancel",btnL:L.tr("uninstall"),bodyText:[L.tr("uninstall-warming-validation")],goingOn:function(){appSelf.appUninstall(r)},stopGoing:function(){L.ui.popDialog(false);return},});e.show()},handleClose:function(){top.location.reload();$("#plugin_detail").hide().empty();$("#plugin_modal").hide();$("body").attr({style:"overflow: auto"})}});return u.insertInto("#plugin_detail")})},formatTime:function(c){function d(b,a){var g=function(e){e+="";return e.replace(/^(\d)$/,"0$1")};var h={yyyy:b.getFullYear(),yy:b.getFullYear().toString().substring(2),M:b.getMonth()+1,MM:g(b.getMonth()+1),d:b.getDate(),dd:g(b.getDate()),hh:b.getHours(),mm:b.getMinutes(),ss:b.getSeconds(),};a||(a="yyyy-MM-dd hh:mm:ss");return a.replace(/([a-z])(\1)*/ig,function(e){return h[e]})}return d(new Date(parseInt(c)*1000))},appPage:function(n){$("#plugin_modal").show();$("body").attr({style:"overflow: hidden"});var s=this;var r=parseInt(n.size);var m=0;for(;Math.floor(r/1024);m++){r=r/1024}r=r.toFixed(2);switch(m){case 0:r=r.toString()+"B";break;case 1:r=r.toString()+"KB";break;case 2:r=r.toString()+"MB";break}var k=n.developer;var o=k.split(",");k=o[0];var p=n.datetime;var l=n.intro.split("\n");var q=new L.cbi.Detail("test",{pluginSection:L.tr("viewmenu-title-allapp"),isExist:false,isInstall:false,isLatest:false,isSet:false,imgUrl:n.icon,pluginData:{title:n.app_name,basicInfo:[{name:L.tr("app-size"),value:r},{name:L.tr("app-model"),value:n.version},{name:L.tr("app-online-time"),value:p}],detailsInfo:[{name:L.tr("app-developer"),value:k}]},appData:l,gloriousName:n,handleInstall:function(a){s.appUpgrade(a.data,s.pendPage)},handleUpdate:function(){},handleUninstall:function(){},handleClose:function(){$("#plugin_detail").hide().empty();$("#plugin_modal").hide();$("body").attr({style:"overflow: auto"})}});return q.insertInto("#plugin_detail")},appCtrol:function(c){var d=new L.cbi.AllappPlugins("upgrade_prompt",{appType:"all",is_new:c.is_new,isOfficial:c.official=="1",isInstalled:true,imgPath:c.icon!=""?c.icon:"/newifi/icons/Extended_06.png",pluginTitle:c.app_name,pluginDescr:c.intro!=""?c.intro:L.tr("author-is-lazy-vedition"),appData:c,installPlugin:function(a){L.xapi.getWanConnStatus().then(function(f){if(f.status!="1"){var b=new L.cbi.Modal("system",{title:L.tr("prompt-message"),footer:"ready",bodyText:L.tr("app-download-now-report-validation"),goingOn:function(){L.ui.popDialog(false);return},});b.show();return}appSelf.appUpgrade(a.data,function(){window.location.reload()})})},detailPage:function(a){appSelf.appPage(a.data)},});d.appendTo($("#map"))},reLoadFun:function(g,f){var e=this;$("#more").empty();var h=new L.cbi.MorePlugins("MorePlugins",{moreState:g,moreApp:function(){f();return},});h.appendTo($("#more"))},getAppSuccess:function(j,l){var m=this;var n=[];var o=[];var h=[];$("#loding").remove();appSelf.appStatus(1);$("#more").empty();if(l==true){n=j}else{h=j.data}if(l!=true&&(!j||!j.data||j.data.length==0)){setTimeout(function(){L.ui.popDialog(false)},1000);$("#map").empty();var k=new L.cbi.AllappPlugins("upgrade_prompt",{isGetFail:true,restart:function(a){top.location.reload()}});k.appendTo($("#map"));return}L.xapi.getLanIp().then(function(f){var d="160108888";var b=f.macaddr.split(":");if((b[0]+b[1]+b[2])=="207693"){var a=b[3]+b[4]+b[5];var e=parseInt("200000",16);var c=parseInt("5FFFFF",16);a=parseInt(a,16);if(a>=e&&a<=c){d="160108666"}}L.xapi.getAppInfo("all").then(function(s){var u;if(!s||!s.appinfo||s.appinfo.length==0){n=h}else{o=s.appinfo;if(l!=true){for(var g=0;g<h.length;g++){u=0;for(var t=0;t<o.length;t++){if(o[t].plugin_ID==h[g].appid){u=1;break}}if(u==0){if(d!=h[g].appid){n.push(h[g])}}}}}if(l==true){appMin+=16;appMax+=16;if(appMax>=n.length){appMax=n.length;appSelf.reLoadFun("0",function(){return})}else{appSelf.reLoadFun("1",function(){appSelf.reLoadFun("2",function(){return});appSelf.getAppSuccess(n,true)})}}else{appMin=0;appMax=n.length<=16?n.length:16;if(n.length<=16){appSelf.reLoadFun("0",function(){return})}else{appSelf.reLoadFun("1",function(){appSelf.reLoadFun("2",function(){return});appSelf.getAppSuccess(n,true)})}}if(l!=true){if(j.data.length<=17){$("#more").empty()}}for(var g=appMin;g<appMax;g++){appSelf.appCtrol(n[g])}setTimeout(function(){L.ui.popDialog(false)},1000)})})},getAppInfo:function(d,e){var f=this;appSelf=this;L.xapi.getAdvanceInfo().then(function(a){if(a.platform=="y1"){devicePlatform="y1"}else{if(a.platform=="y1s"){devicePlatform="y1s"}else{if(a.platform=="newifi-d1"){devicePlatform="newifi-d1"}else{if(a.platform=="newifi-d2"){devicePlatform="newifi-d2"}}}}localMac=a.macaddr;firmware=a.version;url="https://online-api.xcloud.cc/router/plugins/getPlugins/firmware/"+firmware+"/version/"+version+"/mac/"+localMac+"/os/"+os+"/force/false/platform/"+devicePlatform+"/pagesize/0/p/0";var b={};appSelf.dialogDiy();setTimeout(function(){L.xapi.getWanConnStatus().then(function(h){if(h.status!="1"){setTimeout(function(){L.ui.popDialog(false)},1000);$("#map").empty();var c=new L.cbi.AllappPlugins("upgrade_prompt",{isGetFail:true,restart:function(g){top.location.reload()}});$("#loding").remove();c.appendTo($("#map"));return false}else{L.xapi.appAjax(url,b,f.getAppSuccess,function(){if(appFlag==1){return 0}else{f.appStatus(2);appFlag=1}setTimeout(function(){L.ui.popDialog(false)},1000);var g=new L.cbi.AllappPlugins("upgrade_prompt",{appType:"all",isGetFail:true,restart:function(){top.location.reload()}});$("#loding").remove();g.appendTo($("#map"))})}})},1000)})},appStatus:function(b){L.xapi.getAdvanceInfo().then(function(a){devicePlatform=a.platform;versions=a.version;url="https://online-api.xcloud.cc/router/count/Theirapplication"})},dialogDiy:function(){var b=$("<div />").addClass("loding").attr("id","loding").attr("style","margin-top: 100px;").append($("<div />").addClass("pop-body-ingstyle").append($("<div />").addClass("ingstyle-icon icon-refresh")).append($("<p />").addClass("ingstyle-text").text("页面加载中，请稍候...")));$("#map").append(b)},execute:function(){var f=this;appFlag=0;var d=16;var e=0;f.getAppInfo(e,d)}});