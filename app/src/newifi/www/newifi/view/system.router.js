L.ui.view.extend({deleteFile:function(b){L.xapi.deleteFile(b).then(function(a){switch(a){case 0:break;default:}})},information:function(){var b=[L.tr("modal-lan-state"),L.tr("modal-wireless-state"),L.tr("modal-wan-state")];L.xapi.getLanIp().then(function(h){var f=[];var a=[];var g=[];if(h!=undefined){if(h.macaddr!=undefined){g.push(h.macaddr);a.push(L.tr("modal-lan-state-macaddr")+":")}if(h.ipaddr!=undefined){g.push(h.ipaddr);a.push(L.tr("modal-lan-state-ipaddr")+":")}if(h.netmask!=undefined){g.push(h.netmask);a.push(L.tr("modal-lan-state-netmask")+":")}f.push(a);f.push(g)}L.xapi.getWifiInfo(3).then(function(e){var y=[];var z=[];var d=[];var i=[];var t=[];var u=[];var v=[];var w=[];var x=[];var s=[];if(e){for(var c=0;c<e.data.length;c++){switch(e.data[c].type){case 0:i.push("WIFI2.4G:");if(e.data[c].enable=="1"){y.push(L.tr("wifi-on"));if(e.data[c].ssid!=undefined){y.push(e.data[c].ssid);i.push(L.tr("modal-wireless-state-ssid")+":")}if(e.data[c].channel!=undefined){if(e.data[c].channel=="0"){e.data[c].channel=L.tr("2.4Gwifi-channel-auto")}i.push(L.tr("modal-wireless-state-channel")+":");y.push(e.data[c].channel)}}else{y.push(L.tr("wifi-off"))}v.push(i);v.push(y);s.push(v);break;case 2:u.push("WIFI5G:");if(e.data[c].enable=="1"){d.push(L.tr("wifi-on"));if(e.data[c].ssid!=undefined){d.push(e.data[c].ssid);u.push(L.tr("modal-wireless-state-ssid")+":")}if(e.data[c].channel!=undefined){if(e.data[c].channel=="0"){e.data[c].channel=L.tr("5Gwifi-channel-auto")}u.push(L.tr("modal-wireless-state-channel")+":");d.push(e.data[c].channel)}}else{d.push(L.tr("wifi-off"))}x.push(u);x.push(d);s.push(x);break;default:t.push(L.tr("visitor-wifi")+":");if(e.data[c].enable=="1"){z.push(L.tr("wifi-on"));if(e.data[c].ssid!=undefined){z.push(e.data[c].ssid);t.push(L.tr("modal-wireless-state-ssid")+":")}if(e.data[c].channel!=undefined){if(e.data[c].channel=="0"){e.data[c].channel=L.tr("vistor-wifi-channel-auto")}t.push(L.tr("modal-wireless-state-channel")+":");z.push(e.data[c].channel)}}else{z.push(L.tr("wifi-off"))}w.push(t);w.push(z);s.push(w)}}}L.xapi.getWanInfo().then(function(n){var l=[];var k=[];var o=[];if(n){if(n.proto!=undefined){if(n.proto=="dhcp"){o.push(L.tr("DHCP"))}if(n.proto=="pppoe"){o.push(L.tr("PPPOE"))}if(n.proto=="static"){o.push(L.tr("STATIC"))}k.push(L.tr("modal-wan-state-conntype")+":")}if(n.macaddr!=undefined){o.push(n.macaddr);k.push(L.tr("modal-wan-state-macaddr")+":")}if(n.proto=="dhcp"){if(n.dhcp_info.ipaddr!="0.0.0.0"){o.push(n.dhcp_info.ipaddr);k.push(L.tr("modal-wan-state-ipaddr")+":")}if(n.dhcp_info.gateway!=undefined){o.push(n.dhcp_info.gateway);k.push(L.tr("modal-wan-state-gateway")+":")}if(n.dhcp_info.dns1!=undefined||n.dhcp_info.dns2!=undefined){if(n.dhcp_info.dns1.length!=0&&n.dhcp_info.dns1.length!=0){o.push(n.dhcp_info.dns1+";"+n.dhcp_info.dns2);k.push(L.tr("modal-wan-state-dns")+":")}else{o.push(n.dhcp_info.dns1+n.dhcp_info.dns2);k.push(L.tr("modal-wan-state-dns")+":")}}}else{if(n.proto=="static"){if(n.static_info.ipaddr!="0.0.0.0"){o.push(n.static_info.ipaddr);k.push(L.tr("modal-wan-state-ipaddr")+":")}if(n.static_info.gateway!=undefined){o.push(n.static_info.gateway);k.push(L.tr("modal-wan-state-gateway")+":")}if(n.static_info.netmask!=undefined){o.push(n.static_info.netmask);k.push(L.tr("modal-wan-state-netmask")+":")}if(n.static_info.dns1!=undefined||n.static_info.dns2!=undefined){o.push(n.static_info.dns1+";"+n.static_info.dns2);k.push(L.tr("modal-wan-state-dns")+":")}}else{if(n.proto=="pppoe"){if(n.pppoe_info.ipaddr!="0.0.0.0"){o.push(n.pppoe_info.ipaddr);k.push(L.tr("modal-wan-state-ipaddr")+":")}else{o.push("");k.push(L.tr("modal-wan-state-ipaddr")+":")}if(n.pppoe_info.mtu!=undefined){o.push(n.pppoe_info.mtu);k.push("MTU:")}}}}}l.push(k);l.push(o);var j=[b,f,s,l];var m=new L.cbi.Modal("system_prompt",{multiCenter:j,});m.show()})})})},getSysInfo:function(){var b=this;L.xapi.getAdvanceInfo().then(function(j){var k=new L.cbi.Map("system",{pageaction:false});var m=k.section(L.cbi.DummySection,"sysinfo",{caption:L.tr("advance-sysinfo"),buttonValue:L.tr("button-advance-sysinfo"),trigger:true,saveData:["sysinfo"],clickButton:function(){b.information()}});var a="";var o="";if(!j||!j.platform){}else{var n=j.platform;if(n=="y1"){a=L.tr("status-newifi-mini")}else{if(n=="y1s"){a=L.tr("status-newifi-y1s")}else{if(n=="newifi-d1"){a=L.tr("status-newifi-2")}else{if(n=="newifi-d2"){a=L.tr("status-newifi-3")}else{a=L.tr("status-newifi")}}}}}var p="";if(j&&j.macaddr){p=j.macaddr}var l="";if(j&&j.ipaddr&&j.ipaddr!="0.0.0.0"){l=j.ipaddr}m.option(L.cbi.InfoValue,"sys_model",{infoText:[[L.tr("advance-sysinfo-model")+":",a],[L.tr("advance-sysinfo-mac")+":",p],[L.tr("advance-sysinfo-ip")+":",l]]});return k.insertInto("#sys_info_table")})},upgradeStart:function(d){var f=this;var e=new L.cbi.Modal("upgrade_prompt",{title:L.tr("prompt-message"),footer:"both",bodyText:L.tr("prompt-online-upgrade-version-validation1")+d+L.tr("，")+L.tr("prompt-online-upgrade-version-validation2"),stopGoing:function(){f.deleteFile("/tmp/firmware.img");f.deleteFile("/tmp/wget_firmware_result");L.ui.popDialog(false)},goingOn:function(){var a=new L.cbi.Modal("system",{textCenter:[L.tr("prompt-upgrade-validation"),L.tr("prompt-danger-validation")],progressBar:"moving",});a.show();L.xapi.getLanIp().then(function(b){L.xapi.autoUpgradeAction().then(function(h){switch(h.status){case 0:url="http://"+b.ipaddr;L.xapi.jumpToHome(url,function(){var g=new L.cbi.Modal("system",{textCenter:[L.tr("prompt-upgrade-complete-validation")],});g.show()});break;case 2:var c=new L.cbi.Modal("system",{title:L.tr("prompt-message"),bodyText:L.tr("prompt-upgrade-check-failed-validation"),footer:"ready",goingOn:function(){L.ui.popDialog(false)}});c.show();f.deleteFile("/tmp/firmware.img");f.deleteFile("/tmp/wget_firmware_result");break;default:var c=new L.cbi.Modal("system",{title:L.tr("prompt-message"),bodyText:L.tr("prompt-upgrade-failed-validation"),footer:"ready",goingOn:function(){L.ui.popDialog(false)}});c.show();f.deleteFile("/tmp/firmware.img");f.deleteFile("/tmp/wget_firmware_result")}})})}});e.show()},upgradeStart2:function(d){var f=this;var e=new L.cbi.Modal("upgrade_prompt",{title:L.tr("prompt-message"),footer:"both",bodyText:L.tr("prompt-online-upgrade-version-validation1")+d+L.tr("，")+L.tr("prompt-online-upgrade-version-validation2"),stopGoing:function(){f.deleteFile("/tmp/firmware.img");f.deleteFile("/tmp/wget_firmware_result");L.ui.popDialog(false)},goingOn:function(){var a=new L.cbi.Modal("system",{textCenter:[L.tr("prompt-upgrade-validation"),L.tr("prompt-danger-validation")],progressBar:"moving",});a.show();L.xapi.getLanIp().then(function(b){L.xapi.autoUpnowAction().then(function(h){switch(h.status){case 0:url="http://"+b.ipaddr;L.xapi.jumpToHome(url,function(){var g=new L.cbi.Modal("system",{textCenter:[L.tr("prompt-upgrade-complete-validation")],});g.show()});break;case 2:var c=new L.cbi.Modal("system",{title:L.tr("prompt-message"),bodyText:L.tr("prompt-upgrade-check-failed-validation"),footer:"ready",goingOn:function(){L.ui.popDialog(false)}});c.show();f.deleteFile("/tmp/firmware.img");f.deleteFile("/tmp/wget_firmware_result");break;default:var c=new L.cbi.Modal("system",{title:L.tr("prompt-message"),bodyText:L.tr("prompt-upgrade-failed-validation"),footer:"ready",goingOn:function(){L.ui.popDialog(false)}});c.show();f.deleteFile("/tmp/firmware.img");f.deleteFile("/tmp/wget_firmware_result")}})})}});e.show()},upgradeOnLine:function(g){var f=this;var e=new L.cbi.Modal("upgrade_prompt-auto",{bodyText:L.tr("prompt-auto-download-validation"),progressBar:true,});e.show();var h;L.xapi.autoUpgradeDownload().then(function(b){switch(b.status){case 0:h=setInterval(function(){L.xapi.autoUpgradeStat().then(function(d){switch(d.status){case 0:if(d.download_progress=="100"){clearInterval(h);f.upgradeStart(g)}break;case 1:break;case 2:case 3:default:clearInterval(h);var c=new L.cbi.Modal("system",{title:L.tr("prompt-message"),bodyText:L.tr("prompt-upgrade-download-failed-validation"),footer:"ready",goingOn:function(){L.ui.popDialog(false)}});c.show();f.deleteFile("/tmp/firmware.img");f.deleteFile("/tmp/wget_firmware_result")}})},5000);break;case 1:case 2:case 3:default:var a=new L.cbi.Modal("system",{title:L.tr("prompt-message"),bodyText:L.tr("prompt-upgrade-download-failed-validation"),footer:"ready",goingOn:function(){L.ui.popDialog(false)}});a.show();f.deleteFile("/tmp/firmware.img");f.deleteFile("/tmp/wget_firmware_result")}})},localUpgradeProcess:function(){var d=this;var c=new L.cbi.Modal("upgrade_prompt",{title:L.tr("prompt-message"),footer:"both",bodyText:L.tr("prompt-upgrade-messeg"),stopGoing:function(){d.deleteFile("/tmp/firmware.img");L.ui.popDialog(false)},goingOn:function(){var a=new L.cbi.Modal("system",{textCenter:[L.tr("prompt-upgrade-validation"),L.tr("prompt-danger-validation")],progressBar:"moving",});a.show();L.xapi.getLanIp().then(function(b){L.xapi.localUpgradeAction().then(function(h){switch(h.status){case 0:url="http://"+b.ipaddr;L.xapi.jumpToHome(url,function(){var e=new L.cbi.Modal("system",{textCenter:[L.tr("prompt-upgrade-complete-validation")],});e.show()});break;case 2:var g=new L.cbi.Modal("system",{title:L.tr("prompt-message"),bodyText:L.tr("prompt-upgrade-check-platform-failed-validation"),footer:"ready",goingOn:function(){L.ui.popDialog(false)}});g.show();d.deleteFile("/tmp/firmware.img");break;case 6:case 7:var g=new L.cbi.Modal("system",{title:L.tr("prompt-message"),bodyText:L.tr("prompt-upgrade-check-failed-validation"),footer:"ready",goingOn:function(){L.ui.popDialog(false)}});g.show();d.deleteFile("/tmp/firmware.img");break;default:var g=new L.cbi.Modal("system",{title:L.tr("prompt-message"),bodyText:L.tr("prompt-upgrade-failed-validation"),footer:"ready",goingOn:function(){L.ui.popDialog(false)}});g.show();d.deleteFile("/tmp/firmware.img")}})})}});c.show()},upgrade:function(){var f=this;var d="";var e="";L.xapi.getBoardInfo().then(function(a){var b=setInterval(function(){L.xapi.autoUpgradeInfo().then(function(r){if(r.status&&r.status==2&&upgradeFlag!=15){upgradeFlag++;return}else{clearInterval(b)}if(a&&a.distrib_release){d=a.distrib_release}if(r&&r.distrib_release){e=r.distrib_release}var s=new L.cbi.Map("system",{pageaction:false});var m=0;if(!r||r.status!=0||r.upgrade==undefined||r.upgrade!=0){m=1}if(r.status==11&&r.exist==1){m=0}var t=r.exist;var o=r.exist;if(o==1){var c=L.tr("button-advance-upgrade-now")}else{var c=L.tr("button-advance-upgrade")}var p=s.section(L.cbi.DummySection,"upgrade",{caption:L.tr("advance-upgrade"),trigger:true,saveData:["upgrade"],buttonColor:m==0?"green":"unable",buttonValue:c,clickButton:function(g){if(m==1){return}if(o==1){f.upgradeStart2(e)}else{f.upgradeOnLine(e)}}});var q=[];if(r.status!=11){if(m==0){if(r.distrib_log!=""){q=r.distrib_log.split("\n")}}}p.option(L.cbi.UpgradeValue,"upgread_version",{oldVersion:d,newVersion:(r.status!=0||r.upgrade!=0?L.tr("advance-upgrade-newerst-model"):e),hasNew:m==0?true:false,isUse:t==1?true:false,versionInfo:function(){var g=new L.cbi.Modal("system",{pageaction:false,title:L.tr("prompt-upgrade-message-validation"),footer:"ready",lineText:q,goingOn:function(){L.ui.popDialog(false);return},});g.show()},});p.option(L.cbi.UpLoadValue,"upload_local",{url:"/tmp/firmware.img",buttonValue:L.tr("button-advance-upgrade-local"),dealUpgrade:function(h){var j=h.lastIndexOf(".");var g=h.substring(j+1);if(g!="bin"){var i=new L.cbi.Modal("upgrade_prompt",{title:L.tr("prompt-message"),footer:"ready",bodyText:L.tr("prompt-upgrade-last-name-validation"),goingOn:function(){f.deleteFile("/tmp/firmware.img");L.ui.popDialog(false)},});i.show();return}setTimeout(function(){L.xapi.firmwareCheck().then(function(l){switch(l.status){case 0:f.localUpgradeProcess();break;case 2:var k=new L.cbi.Modal("system",{title:L.tr("prompt-message"),bodyText:L.tr("prompt-upgrade-check-platform-failed-validation"),footer:"ready",goingOn:function(){L.ui.popDialog(false)}});k.show();f.deleteFile("/tmp/firmware.img");break;case 3:case 4:var k=new L.cbi.Modal("system",{title:L.tr("prompt-message"),bodyText:L.tr("prompt-upgrade-check-failed-validation"),footer:"ready",goingOn:function(){L.ui.popDialog(false)}});k.show();f.deleteFile("/tmp/firmware.img");break;case 1:case 5:default:var k=new L.cbi.Modal("system",{title:L.tr("prompt-message"),bodyText:L.tr("prompt-upload-failed-validation"),footer:"ready",goingOn:function(){L.ui.popDialog(false)}});k.show()}})},5000)}});return s.insertInto("#upgrade")})},1000)})},setPasswd:function(){var g=this;var h=new L.cbi.Map("system",{pageaction:false});var f=h.section(L.cbi.DummySection,"set_pass_word",{caption:L.tr("advance-passwd"),trigger:true,buttonValue:L.tr("Save"),saveData:["set_pass_word","old_passwd","new_passwd","re_passwd"],clickButton:function(d){var e="#panel_system_set_pass_word_set_pass_word .error-text";if(d.old_passwd==""||d.new_passwd==""||d.re_passwd==""){$(e).show().text(L.tr("passwd-null-validation")).delay(3000).fadeOut(500);return}if(/[^\x00-\xff]/.test(d.old_passwd)||/[^\x00-\xff]/.test(d.new_passwd)||/[^\x00-\xff]/.test(d.re_passwd)){return}L.ui.sectionSave("saving","set_pass_word");if(!d){return false}$.base64.utf8encode=true;var b=$.base64("encode",d.old_passwd.replace(/\\/g,"\\\\"));var a=$.base64("encode",d.new_passwd.replace(/\\/g,"\\\\"));var c=$.base64("encode",d.re_passwd.replace(/\\/g,"\\\\"));L.xapi.setPasswdBase(b,a,c).then(function(l){switch(l.status){case 0:L.ui.sectionSave("saveS","set_pass_word");L.xapi.getLanIp().then(function(k){url="/";L.xapi.jumpToURL(url,3000)});break;case 2:L.ui.sectionSave("saveF","set_pass_word");$(e).show();$(e).text(L.tr("passwd-err-validation")).delay(3000).fadeOut(500);break;case 1:case 3:default:L.ui.sectionSave("saveF","set_pass_word");$(e).show();$(e).text(L.tr("save-fail-validation")).delay(3000).fadeOut(500)}setTimeout(function(){L.ui.sectionSave("close","set_pass_word")},3000)})}});f.option(L.cbi.PasswordValue,"old_passwd",{caption:L.tr("advance-passwd-old"),datatype:"sysPwd"});var i=f.option(L.cbi.PasswordValue,"new_passwd",{caption:L.tr("advance-passwd-new"),datatype:function(){var b=i.formvalue("set_pass_word");var a=j.formvalue("set_pass_word");if(!b||b.length<1||b.length>64){return L.tr("sysPwd-wrong-length-validation")}else{if(/[^\x00-\xff]/.test(b)){return L.tr("pwd-zh-format-validation")}else{if(/[^\w~!@#$%^&*()+;.\[\]\,\\\/-]/.test(b)){return L.tr("pwd-special-format-validation")}else{if(b==a){$("#set_pass_word_re_passwd").parent().removeClass("has-error").parents(".luci2-field").find(".label-danger").hide().parents(".luci2-field").removeClass("luci2-form-error")}else{if(a&&a.length&&b!=a){return L.tr("twice-input-not-match-validation")}else{return true}}}}}}});var j=f.option(L.cbi.PasswordValue,"re_passwd",{caption:L.tr("advance-passwd-repeat"),datatype:function(){var b=i.formvalue("set_pass_word");var a=j.formvalue("set_pass_word");if(!a||a.length<1||a.length>64){return L.tr("sysPwd-wrong-length-validation")}else{if(/[^\x00-\xff]/.test(a)){return L.tr("pwd-zh-format-validation")}else{if(/[^\w~!@#$%^&*()+;.\[\]\,\\\/-]/.test(a)){return L.tr("pwd-special-format-validation")}else{if(a==b){$("#set_pass_word_new_passwd").parent().removeClass("has-error").parents(".luci2-field").find(".label-danger").hide().parents(".luci2-field").removeClass("luci2-form-error")}else{if(b&&b.length&&b!=a){return L.tr("twice-input-not-match-validation")}}}}}return true}});f.option(L.cbi.ErrorMsgValue,"error",{caption:L.tr(""),});return h.insertInto("#passwd")},reboot:function(){var d=new L.cbi.Map("system",{pageaction:false});var c=d.section(L.cbi.DummySection,"re_boot",{caption:L.tr("advance-reboot"),trigger:true,saveData:["re_boot"],buttonValue:L.tr("button-advance-reboot"),clickButton:function(){var a=new L.cbi.Modal("system",{pageaction:false,title:L.tr("prompt-message"),footer:"both",bodyText:L.tr("reboot-prompt-message-validation"),goingOn:function(){var b=new L.cbi.Modal("system",{textCenter:[L.tr("reboot-now-validation"),L.tr("prompt-danger-validation")],progressBar:true,});b.show();L.xapi.getLanIp().then(function(f){url="http://"+f.ipaddr+"/index.html";L.xapi.restart().then(function(){L.xapi.jumpToHome(url,function(){})})})},stopGoing:function(){L.ui.popDialog(false);return}});a.show()}});c.option(L.cbi.LabelValue,"label",{labelText:L.tr("advance-reboot-view")});return d.insertInto("#reboot")},reset:function(){var d=new L.cbi.Map("system",{pageaction:false});var c=d.section(L.cbi.DummySection,"reset",{caption:L.tr("advance-reset"),trigger:true,saveData:["reset"],buttonValue:L.tr("button-advance-reset"),clickButton:function(){var a=new L.cbi.Modal("system",{pageaction:false,title:L.tr("prompt-message"),footer:"both",bodyText:L.tr("prompt-reset-message-validation"),goingOn:function(){var b=new L.cbi.Modal("system",{bodyText:[L.tr("reset-now-validation"),L.tr("prompt-danger-validation")],progressBar:true,});b.show();url="http://192.168.99.1/index.html";L.xapi.reset().then(function(f){setTimeout(function(){var e=window.setInterval(function(){$.ajax({type:"GET",cache:false,url:url,dataType:"jsonp",success:function(h){window.location.href=url},error:function(h){if(h.status==200){window.location.href=url}return}})},5000)},25000)})},stopGoing:function(){L.ui.popDialog(false);return}});a.show()}});c.option(L.cbi.LabelValue,"label",{labelText:L.tr("advance-reset-view")});return d.insertInto("#reset")},syslog:function(){var d=new L.cbi.Map("system",{pageaction:false});var c=d.section(L.cbi.DummySection,"sys_log",{caption:L.tr("advance-syslog"),trigger:true,saveData:["sys_log"],buttonValue:L.tr("button-download-syslog"),clickButton:function(){var a=new L.cbi.Modal("system",{bodyText:[L.tr("prompt-syslog-view-validation")],progressBar:true,});a.show();L.xapi.deleteFile("/www/newifi/syslog.gz").then(function(b){switch(b){case 0:break;default:}});L.xapi.Syslog("all","/www/newifi/syslog").then(function(f){if(!f){var b=new L.cbi.Modal("system",{pageaction:false,title:L.tr("prompt-message"),footer:"ready",bodyText:L.tr("prompt-syslog-message-failed-validation"),goingOn:function(){L.ui.popDialog(false);return},});b.show()}switch(f.status){case 0:setTimeout(function(){var e=document.createElement("iframe");e.src="/newifi/syslog.gz";e.style.display="none";document.body.appendChild(e);var h=new L.cbi.Modal("system",{pageaction:false,title:L.tr("prompt-message"),footer:"ready",bodyText:L.tr("prompt-syslog-message-ready-validation"),goingOn:function(){L.ui.popDialog(false);return},});h.show()},0);break;default:var b=new L.cbi.Modal("system",{pageaction:false,title:L.tr("prompt-message"),footer:"ready",bodyText:L.tr("prompt-syslog-message-failed-validation"),goingOn:function(){L.ui.popDialog(false);return},});b.show()}setTimeout(function(){L.xapi.deleteFile("/www/newifi/syslog.gz").then(function(e){switch(e){case 0:break;default:}})},30000)})}});c.option(L.cbi.LabelValue,"label",{labelText:L.tr("advance-syslog-view")});return d.insertInto("#syslog")},execute:function(){var d=this;L.xapi.getBoardInfo().then(function(a){});var c=new L.cbi.Modal("upgrade_prompt",{bodyText:L.tr("page-loading-validation"),});c.show();setTimeout(function(){L.ui.popDialog(false)},1000);this.getSysInfo();this.upgrade();this.setPasswd();this.reboot();this.reset();this.syslog();return}});