L.ui.view.extend({renderNetArea:function(){var o=this;var p=echarts.init(document.getElementById("net_line"));var m={tooltip:{show:true,trigger:"item",formatter:function(c){var b=new Date(c[1]);var a=o.byteToSize(c.value);data=(b.getMonth()+1)+L.tr("month")+b.getDate()+L.tr("day")+" "+b.getHours()+":"+b.getMinutes();return data+"<br />"+a}},legend:{selectedMode:false,x:"right",data:[L.tr("upload"),L.tr("download")]},grid:{x:60,y:30,x2:5,y2:20,borderWidth:0,},xAxis:[{type:"category",splitNumber:10,boundaryGap:false,splitLine:false,axisTick:false,axisLabel:false,splitArea:false,axisLine:{lineStyle:{color:"#ccc",width:1}},data:(function(){var a=new Date();var c=[];var b=10;while(b--){c.push(a)}return c})()}],yAxis:[{type:"value",boundaryGap:[2,0.2],scale:true,min:0,axisLabel:{formatter:function(a){var b;function c(e){if(e==0){return"0"}var f=1024;var g=["B/s","KB/s","MB/s","GB/s"];var d=Math.floor(Math.log(e)/Math.log(f));return parseInt(e/Math.pow(f,d))+g[d]}b=c(a);return b}},axisLine:{lineStyle:{color:"#ccc",width:1}},splitNumber:3,splitLine:false,axisTick:false,splitArea:false,}],series:[{name:L.tr("download"),type:"line",smooth:true,itemStyle:{normal:{color:"#007ad3",lineStyle:{color:"#5ca7eb"},areaStyle:{type:"default",}}},showAllSymbol:true,symbolSize:0,data:[0,0,0,0,0,0,0,0,0,0]},{name:L.tr("upload"),type:"line",smooth:true,itemStyle:{normal:{color:"#94e5a5",lineStyle:{color:"#29cc4c"},areaStyle:{type:"default",}}},showAllSymbol:true,symbolSize:0,data:[0,0,0,0,0,0,0,0,0,0]}]};var j=0,n=0;var i,k;function l(){L.xapi.getRate().then(function(a){j=a.down_rate;n=a.up_rate})}l();clearInterval(k);k=setInterval(function(){l();i=(new Date());p.addData([[0,j,false,false,i],[1,n,false,false,i]])},5000);timeInterval.push(k);p.setOption(m)},renderBoardInfo:function(){return L.xapi.getBoardInfo().then(function(c){var d=c.distrib_platform;if(d=="y1"){$("#os_model span").text(L.tr("status-newifi-mini"));$(".status-os").addClass("status-os-y1")}else{if(d=="y1s"){$("#os_model span").text(L.tr("status-newifi-y1s"));$(".status-os").addClass("status-os-y1s")}else{if(d=="newifi-d1"){$("#os_model span").text(L.tr("status-newifi-2"));$(".status-os").addClass("status-os-d1")}else{if(d=="newifi-d2"){$("#os_model span").text(L.tr("status-newifi-3"));$(".status-os").addClass("status-os-d2")}else{$("#os_model span").text(L.tr("status-newifi"));$(".status-os").addClass("status-os-y1")}}}}$("#os_version span").text("V "+c.distrib_release)})},renderWanConnStatus:function(){var d=["https://www.baidu.com/home/other/data/weatherInfo","http://wthrcdn.etouch.cn/weather_mini?city=%E6%88%90%E9%83%BD"];var f=0;function e(){$.ajax({url:d[f],type:"get",dataType:"jsonp",timeout:5000,success:function(a){$("#link-icon").attr("style","background-position: 0 0;")},error:function(){if(f<2){f++;e()}else{$("#link-icon").attr("style","background-position: -82px 0;")}}})}return L.xapi.getWanConnStatus().then(function(a){if(a.status==1){e()}else{if(a.phystatus==1){$("#link-icon").attr("style","background-position: -82px 0;")}else{$("#link-icon").attr("style","background-position: -41px 0;")}}})},renderDevice:function(){return L.xapi.getDeviceInfo().then(function(b){$("#pc_num").text(b.info.length+L.tr("unit-tai"))})},renderDiskInfo:function(){var r=this;var o=0;function l(b,d){var c=echarts.init(document.getElementById("storage_pie"));var a={animation:false,tooltip:{show:false},legend:{show:false,data:[L.tr("status-used-storage"),L.tr("status-free-storage")]},calculable:false,color:["#ffa800","#94d6ff"],series:[{name:"disStorate",type:"pie",radius:["55%","90%"],borderWidth:0,itemStyle:{normal:{label:{position:"inner",formatter:function(e){var f=Math.round(e.percent);if(f>12){return f+"%"}else{return""}},textStyle:{fontSize:"14"}},labelLine:{show:false}},emphasis:{label:{show:true,position:"inner",formatter:function(e){var f=Math.round(e.percent);if(f>12){return f+"%"}else{return""}},textStyle:{fontSize:"14"}}}},data:[{value:b,name:L.tr("status-used-storage")},{value:d,name:L.tr("status-free-storage"),itemStyle:{normal:{label:{show:false}},emphasis:{label:{show:false}}}}]}]};c.setOption(a)}function t(c){var a=c.substring(c.length-1,c.length);var b=parseFloat(c);if(a=="T"){c=(b*1024).toFixed(1).toString()+"G"}else{if(a=="G"){c=b.toFixed(1).toString()+"G"}else{if(a=="M"){c=(b/1024).toFixed(1).toString()+"G"}else{if(a=="K"){c=(b/1024/1024).toFixed(1).toString()+"G"}}}}return c}function s(h,b){var i,a,j,d,f,c,g,e;i=h[b];diskUrl=i.partition[0].mount_dir;g=diskUrl.substring(diskUrl.lastIndexOf("/")+1,diskUrl.lastIndexOf("/")+4);a=t(i.disk_total_size);j=t(i.disk_used_size);d=t(i.disk_free_size);freeSizeInt=parseFloat(d.substring(0,d.length-1));diskSource=i.xcloud_used_disk;$("#storage_total span").text(a);$("#storage_used span").text(j);$("#storage_unused span").text(d);if(g=="mmc"){$(".storage-exit a").hide();$(".storage-title").text(L.tr("status-my-TF"))}else{e=i.partition[0].vendor_name;$(".storage-exit a").show().attr("id",g);if(e=="unknown"||e==""){$(".storage-title").text(L.tr("status-my-device"))}else{$(".storage-title").text(e)}}if(freeSizeInt<=0.1){$(".storage-status").show()}else{$(".storage-status").hide()}if(diskSource=="1"){$(".storage-source").show()}else{$(".storage-source").hide()}f=parseFloat(j);c=parseFloat(d);l(f,c)}function m(d){$("#chart_list").empty();var a,c=0;for(var b=0;b<d.length;b++){if(d[b]==undefined){continue}else{c++}}a=c;if(a<o+1){o=0}if(a>8){a=8}for(var b=0;b<a;b++){if(b==o){$("#chart_list").append('<li class="li-active"><a href="javascript: void(0)" id='+b+"></a></li>")}else{$("#chart_list").append('<li><a href="javascript: void(0)" id='+b+"></a></li>")}}}function n(a){var b=new Array();var c;for(var d=0;d<a.usb.length;d++){if(a.usb[d].partition.length==0){continue}else{if(a.usb[d].partition[0].mount_dir.substring(0,11)=="/mnt/mmcblk"){c=a.usb[d];b[d]=b[0];b[0]=c}else{b[d]=a.usb[d]}}}for(var e=0;e<b.length;e++){if(b[e]==undefined||b[d]==""){b[e]=b[b.length-1];b.pop()}}return b}function p(){var a=this;L.xapi.getDiskInfo().then(function(b){if(b.usb){var d=b.usb.length;if(d==0){$("#storage_no").show();$("#help-info").show();$("#storage_list").hide()}else{if(!b.usb[0].partition){$("#storage_no").show();$("#help-info").show();$("#storage_list").hide();return}$("#storage_list").show();$("#storage_no").hide();$("#help-info").hide();$(".storage-exit span").hide();var c=[];c=n(b);m(c);s(c,o);$("#chart_list li a").click(function(){var e=$(this).attr("id");o=parseInt(e);$(this).parent("li").addClass("li-active").siblings().removeClass("li-active");$(".storage-exit span").hide();s(c,e)})}}else{$("#storage_no").show();$("#storage_list").hide()}})}p();var k=setInterval(p,10000);timeInterval.push(k);function q(){function a(b){return L.xapi.unMountUsbDevice(b).then(function(c){if(c.status==0){$(".storage-exit span").text(L.tr("status-safe-exit-succcess")).attr("style","color: #29cc4c;");setTimeout(r.renderDiskInfo,3000)}else{$(".storage-exit span").text(L.tr("status-safe-exit-fail")).attr("style","color: #c7254e;");setTimeout(r.renderDiskInfo,3000)}})}$(".storage-exit a").click(function(){clearInterval(k);var b=$(this).attr("id");$(".storage-exit span").text(L.tr("status-exiting")).attr("style","color: #007ad3;");a(b)})}q()},byteToSize:function(b){if(b==0){return"0B/s"}var c=1024;var g=["B/s","KB/s","MB/s","GB/s"];var h=Math.floor(Math.log(b)/Math.log(c));return(b/Math.pow(c,h)).toFixed(1)+g[h]},renderNetInfo:function(){var j=this;var o=[];var l=[];var n,r,p,k;function q(){L.xapi.getRate().then(function(g){var f=(g.up_rate==""||g.up_rate==undefined)?0:g.up_rate;var a=(g.down_rate==""||g.down_rate==undefined)?0:g.down_rate;var b=0,c=0;n=j.byteToSize(f);r=j.byteToSize(a);l.push(a);o.push(f);if(l.length>6){var e=1;for(var d=0;d<l.length;d++){l[d]=l[e];e++}l.pop()}if(o.length>6){var e=1;for(var d=0;d<o.length;d++){o[d]=o[e];e++}o.pop()}for(var d=0;d<l.length;d++){c+=l[d]}for(var d=0;d<o.length;d++){b+=o[d]}p=j.byteToSize(c/(l.length));k=j.byteToSize(b/(o.length));$("#cur_up").text(n);$("#cur_down").text(r);$("#net_down_avg span").text(p);$("#net_up_avg span").text(k)});L.xapi.getMaxRate().then(function(c){if(c.status==0){var a=j.byteToSize(c.max_down_rate);var b=j.byteToSize(c.max_up_rate);$("#net_down_max span").text(a);$("#net_up_max span").text(b)}})}q();j.renderNetArea();var m=setInterval(q,5000);timeInterval.push(m)},execute:function(){var f=this;f.renderWanConnStatus();f.renderDevice();f.renderBoardInfo();f.renderDiskInfo();f.renderNetInfo();setTimeout(function(){if(upgradeFlag){$("#os_version_tip").css("display","block").click(function(){L.setHash("view","system/router");$('#mainmenu ul li:eq("3")').addClass("item-active").siblings().removeClass("item-active")})}},500);clearInterval(d);var d=setInterval(f.renderWanConnStatus,5000);timeInterval.push(d);clearInterval(e);var e=setInterval(f.renderDevice,10000);timeInterval.push(e);$(".status-wan").click(function(){L.setHash("view","system/internet");$('#mainmenu ul li:eq("3")').addClass("item-active").siblings().removeClass("item-active")});$(".status-pc").click(function(){L.setHash("view","devices/accesettings");$('#mainmenu ul li:eq("1")').addClass("item-active").siblings().removeClass("item-active")});if(window.history&&window.history.pushState){$(window).on("popstate",function(){window.history.pushState("forward",null,"");window.history.forward(1)})}window.history.pushState("forward",null,"");window.history.forward(1);$(document).keydown(function(c){var a;var h=(c.keyCode)||(c.which)||(c.charCode);if(h==8){var b=c.srcElement||c.target;if(b.tagName.toUpperCase()=="INPUT"||b.tagName.toUpperCase()=="TEXTAREA"){a=b.readOnly||b.disabled;if(b.type.toUpperCase()=="SUBMIT"||b.type.toUpperCase()=="RADIO"||b.type.toUpperCase()=="CHECKBOX"||b.type.toUpperCase()=="BUTTON"){a=true}}else{a=true}}else{a=false}if(a){c.preventDefault()}})}});