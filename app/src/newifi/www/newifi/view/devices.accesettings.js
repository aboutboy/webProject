L.ui.view.extend({switchClick1:function(d){var f=$(this);if(f.attr("unable")=="yes"){return}f.attr("unable","yes");var e={};e.type=1;e.ip=d.data[2];if(f.attr("name")=="ch"){e.enable=0}else{e.enable=1}L.xapi.setDiveceAcl(JSON.stringify(e)).then(function(a){if(e.enable==0){f.attr("name","");f.css("background",'url("/newifi/icons/Equipment_01_02.png") 0 0')}else{f.attr("name","ch");f.css("background",'url("/newifi/icons/Equipment_01_02.png") 0 -24px')}setTimeout(function(){f.attr("unable","no")},2000)})},switchClick2:function(g){var f=$(this);if(f.attr("unable")=="yes"){return}f.attr("unable","yes");var h={};h.type=2;h.ip=g.data[2];if(f.attr("name")!="ch"){h.enable=1;L.xapi.setDiveceAcl(JSON.stringify(h)).then(function(a){switch(a.status){case 0:f.attr("name","ch");f.css("background",'url("/newifi/icons/Equipment_01_02.png") 0 -24px');var b=new L.cbi.Modal("acc-setting",{bodyText:L.tr("acc-setting-success"),});b.show();setTimeout(function(){L.ui.popDialog(false)},2000);break;default:var b=new L.cbi.Modal("acc-set-fail",{title:L.tr("prompt-message"),bodyText:L.tr("acc-setting-fail"),footer:"single",btnS:"sure",});b.show()}setTimeout(function(){f.attr("unable","no")},2000)})}else{h.enable=0;var e=new L.cbi.Modal("access-tip",{title:L.tr("prompt-message"),bodyText:L.tr("acc-setting-second-sure"),footer:"both",stopGoing:function(){f.attr("unable","no");return},goingOn:function(){L.xapi.setDiveceAcl(JSON.stringify(h)).then(function(a){switch(a.status){case 0:f.attr("name","");f.css("background",'url("/newifi/icons/Equipment_01_02.png") 0 0');var b=new L.cbi.Modal("acc-setting",{bodyText:L.tr("acc-setting-success"),});b.show();setTimeout(function(){L.ui.popDialog(false)},2000);break;default:var b=new L.cbi.Modal("acc-set-fail",{title:L.tr("prompt-message"),bodyText:L.tr("acc-setting-fail"),footer:"single",btnS:"sure",});b.show()}setTimeout(function(){f.attr("unable","no")},2000)})},});e.show()}},editDeviceName:function(c){c.data.stopRefresh();$(this).parents("div.acc-text").hide();var d=$(this).parents("div.acc-column-one");d.find("input.acc-input-name").show();d.find("input.acc-input-name").focus()},inputKeyUp:function(){var d=$(this).val();var c=$(this).parents("div.acc-column-one");if(d.replace(/[^\x00-\xff]/g,"abc").length>27){c.find("p.acc-input-wrong").show();c.addClass("has-error")}else{c.find("p.acc-input-wrong").hide();c.removeClass("has-error")}},inputBlur:function(i){var g=$(this).val();var f=$(this).parents("div.acc-column-one");var j=f.find("span.acc-name").text();if(g.length!=0&&f.attr("class").indexOf("has-error")==-1&&j!=g){f.find("span.acc-name").text(g);$.base64.utf8encode=true;g=$.base64("encode",g);var h=$(this).parents("div.acc-row").find("span.acc-info-right:eq(0)").text();L.xapi.setDeviceNickname(g,h).then(function(a){switch(a.status){case 0:break;default:}})}else{$(this).val(j)}f.find("div.acc-text").show();f.find("input.acc-input-name").hide();f.find("p.acc-input-wrong").hide();i.data.self.autoRefresh(i.data.m,i.data.self)},accSetting:function(s){var r=s.isSpeed;var A=s.equipmentType;var u=s.name=="unkown"?L.tr("unknown-device-name"):s.name;var x=s.netType;var B=s.mac;var m=s.producer_info;var y=s.ip;var t=s.time;var v=s.switchState1;var z=s.switchState2;var w=s.selfDevice;var C=s.self;var D=s.m;var q=D.section(L.cbi.DevicesAccSection,"deviceAccSection",{isSpeed:r,equipmentType:A,producer_info:m,devicesName:u,netType:x,macAddr:B,ipAddr:y,self:C,m:D,conectedTime:t,switchState1:v,switchState2:z,isSelfDevice:w,switchClick1:this.switchClick1,switchClick2:this.switchClick2,editDeviceName:this.editDeviceName,inputKeyUp:this.inputKeyUp,inputBlur:this.inputBlur,});return s.m},parseData:function(A,B,m,u,w){var w=this;var i={};var C={};var y=m.info;for(var E=0;E<y.length;E++){C[y[E].ip]=y[E]}i.isSpeed=m.qosenable=="0"?false:C[A.ip].enable=="1"?true:false;var j=-1;var z=[["pc","windows","imac"],["android","iphone","winphone","samsung","Sony"],["pad","ipad"]];i.equipmentType="3";var j=-1;for(var E=0;E<z.length;E++){for(var x=0;x<z[E].length;x++){j=A.device_name.toLowerCase().indexOf(z[E][x]);if(j!=-1){i.equipmentType=E.toString()}}}i.switchState1=B[A.ip].netenable=="1"?true:false;i.switchState2=B[A.ip].smbenable=="1"?true:false;var t;if(A.device_nickname=="none"){t=A.device_name}else{t=$.base64.atob(A.device_nickname,true)}i.mac=A.mac;i.ip=A.ip;if(A.connect_type=="lan"){i.netType=L.tr("lan-net")}else{if(A.connect_type=="ra0"){i.netType=L.tr("2.4G-wifi")}else{if(A.connect_type=="rai0"){i.netType=L.tr("5G-wifi")}else{i.netType=L.tr("visitor-wifi")}}}i.name=t;var D=parseInt(A.time/86400);var v=parseInt((A.time%86400)/3600);var F=parseInt(((A.time%86400)%3600)/60);i.time=D.toString()+L.tr("day")+v+L.tr("hour")+F+L.tr("minite");i.selfDevice=A.selfDevice;i.m=u;i.self=w;i.producer_info=A.producer_info;return i},getSelfDeviceMac:function(b){$.ajax({url:"/cgi-bin/get_clientmac.cgi",method:"post",enctype:"multipart/form-data",success:function(a){a=a.replace("\n","");a=a.substring(0,a.length-1);b(a)}})},accGetInfo:function(c){var d=c.context;L.xapi.getDeviceInfo().then(function(a){L.xapi.getDeviceAcl().then(function(h){var b=h.info;var j={};for(var i=0;i<b.length;i++){j[b[i].ip]=b[i]}d.getSelfDeviceMac(function(m){var f={};var g=a.info.length;for(var n=0;n<g;n++){a.info[n].selfDevice=false;if(a.info[n].mac==m){a.info[n].selfDevice=true;f=a.info[n];a.info[n]=a.info[0];a.info[0]=f;break}}for(var n=1;n<g-1;n++){for(var e=1;e<g-n;e++){if(a.info[e].time>a.info[e+1].time){f=a.info[e+1];a.info[e+1]=a.info[e];a.info[e]=f}}}L.xapi.getSmartQos().then(function(p){if(a.info.length!=0){if(c.m.sections.length==0||c.isClick){for(var l=0;l<a.info.length;l++){c.m=d.accSetting(d.parseData(a.info[l],j,p,c.m,d))}c.m.redraw()}else{if(c.m.sections.length!=a.info.length||c.isClick){c.m.sections=[];for(var l=0;l<a.info.length;l++){c.m=d.accSetting(d.parseData(a.info[l],j,p,c.m,d))}}else{for(var l=0;l<a.info.length;l++){var k=d.parseData(a.info[l],j,p,c.m);c.m.sections[l].options=d.dataDeal(k,c.m.sections[l].options)}}}c.m.redraw()}})})})})},dataDeal:function(c,d){d.isSpeed=c.isSpeed;d.equipmentType=c.equipmentType;d.devicesName=c.name=="unkown"?L.tr("unknown-device-name"):c.name;d.netType=c.netType;d.macAddr=c.mac;d.ipAddr=c.ip;d.conectedTime=c.time;d.switchState1=c.switchState1;d.switchState2=c.switchState2;d.isSelfDevice=c.selfDevice;return d},acc_refresh:function(d){var e=$(this);if(e.attr("name")=="ch"){return}e.attr("name","ch");var f=new L.cbi.Map("accsection",{pageaction:false});$("#map").empty();f.insertInto("#map");setTimeout(function(){d.data.accGetInfo({m:f,isClick:true,context:d.data})},300);setTimeout(function(){e.attr("name","")},1000);d.data.autoRefresh(f,d.data)},autoRefresh:function(f,d){d.stopRefresh();var e=setInterval(function(){d.accGetInfo({m:f,isClick:false,context:d})},20000);timeInterval.push(e)},stopRefresh:function(){for(var b=0;b<timeInterval.length;b++){window.clearInterval(timeInterval[b])}timeInterval=[]},execute:function(){var c=this;var d=new L.cbi.Map("accsection",{pageaction:false});d.insertInto("#map");$("#acc_refresh").on("click",c,this.acc_refresh);c.accGetInfo({m:d,isClick:false,context:c});c.autoRefresh(d,c);return}});