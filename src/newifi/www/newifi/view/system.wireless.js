L.ui.view.extend({switchDeal:function(k,l){var j=0;if($(".section-switch").attr("unable")=="yes"&&l){return}$(".section-switch").attr("unable","yes");var g="",h="",i="";if(k.attr("name")=="ch"){k.attr("name","");g='url("/newifi/icons/Equipment_01_02.png")';h="none";i="block"}else{k.attr("name","ch");g='url("/newifi/icons/Equipment_01_02.png") 0px -24px';h="block";i="none"}k.css("background",g);k[0].parentNode.parentNode.childNodes[1].style.display=h;k[0].parentNode.parentNode.childNodes[2].style.display=h;k[0].parentNode.parentNode.childNodes[3].style.display=i;setTimeout(function(){$(".section-switch").attr("unable","no")},j)},closeWifi:function(d,c){L.xapi.setWifi(d.type,"0",d.ssid,d.encryption,d.key,d.channel,"100",d.hidessid,d.htmode).then(function(a){switch(a.status){case 0:if(c=="ra0"){$("#section-pane-ra0").find(".luci2-form-error").removeClass("luci2-form-error");$("#section-pane-ra0").find(".has-error").removeClass("has-error");$("#section-pane-ra0").find(".luci2-field-error").hide();$("#ra0_ssid").val(d.ssid);$("#ra0_hidessid").attr("values",d.hidessid);$("#ra0_hidessid").attr("checked",d.hidessid=="0"?false:true);$("#section-pane-ra0").find("input.password-input:eq(0)").val(d.key);$("#section-pane-ra0").find("input.password-input:eq(1)").val(d.key);$("#collapse-id-ra0").css("background",'url("/newifi/icons/Settings_wifi_02.png") 0 0px');$("#ra0___advance").attr("name","");$("#ra0_encryption").attr("values",d.encryption);$("#ra0_channel").attr("values",d.channel);$("#ra0_channel").find("span.listra0").text(d.channel=="auto"?L.tr("wirless-chanel-auto"):d.channel);if(d.encryption=="none"){$("#section-pane-ra0").find("div.luci2-field:eq(1)").hide();$("#ra0_encryption").find("span.listra0").text(L.tr("No encryption"))}else{if(d.encryption=="psk2"){$("#section-pane-ra0").find("div.luci2-field:eq(1)").show();$("#ra0_encryption").find("span.listra0").text(L.tr("WPA2 Personal (PSK)"))}else{$("#section-pane-ra0").find("div.luci2-field:eq(1)").show();$("#ra0_encryption").find("span.listra0").text(L.tr("WPA/WPA2 Personal (PSK) mixed"))}}$("#section-pane-ra0").find("div.luci2-field:eq(4)").hide();$("#section-pane-ra0").find("div.luci2-field:eq(5)").hide();$("#section-pane-ra0").find("div.luci2-field:eq(6)").hide()}else{if(c=="rai0"){$("#section-pane-rai0").find(".luci2-form-error").removeClass("luci2-form-error");$("#section-pane-rai0").find(".has-error").removeClass("has-error");$("#section-pane-rai0").find(".luci2-field-error").hide();$("#rai0_ssid").val(d.ssid);$("#rai0_hidessid").attr("values",d.hidessid);$("#rai0_hidessid").attr("checked",d.hidessid=="0"?false:true);$("#section-pane-rai0").find("input.password-input:eq(0)").val(d.key);$("#section-pane-rai0").find("input.password-input:eq(1)").val(d.key);$("#collapse-id-rai0").css("background",'url("/newifi/icons/Settings_wifi_02.png") 0 0px');$("#rai0___advance").attr("name","");$("#rai0_encryption").attr("values",d.encryption);$("#rai0_channel").attr("values",d.channel);$("#rai0_channel").find("span.listrai0").text(d.channel=="auto"?L.tr("wirless-chanel-auto"):d.channel);if(d.encryption=="none"){$("#rai0_encryption").find("span.listrai0").text(L.tr("No encryption"));$("#section-pane-rai0").find("div.luci2-field:eq(1)").hide()}else{if(d.encryption=="psk2"){$("#section-pane-rai0").find("div.luci2-field:eq(1)").show();$("#rai0_encryption").find("span.listrai0").text(L.tr("WPA2 Personal (PSK)"))}else{$("#section-pane-rai0").find("div.luci2-field:eq(1)").show();$("#rai0_encryption").find("span.listrai0").text(L.tr("WPA/WPA2 Personal (PSK) mixed"))}}$("#section-pane-rai0").find("div.luci2-field:eq(4)").hide();$("#section-pane-rai0").find("div.luci2-field:eq(5)").hide();$("#section-pane-rai0").find("div.luci2-field:eq(6)").hide()}}L.ui.sectionSave("close",c);break;case 17:break;case 18:break;case 20:break;case 23:break;default:}})},openWifi:function(b){L.xapi.setWifi(b.type,"1",b.ssid,b.encryption,b.key,"auto","100","0","0").then(function(a){switch(a.status){case 0:break;case 17:break;case 18:break;case 20:break;case 23:break;default:}})},sectionCreate:function(k,m,i,l){var h=this;var j=10000;var n=k.section(L.cbi.DummySection,i,{caption:L.tr(m),trigger:true,buttonValue:L.tr("Save"),sectionWarn:l.type==0?L.tr("wireless-close-2.4G-view"):(l.type==2?L.tr("wireless-close-5G-view"):L.tr("wireless-close-visitor-view")),saveData:[i,"ssid","password","encryption","channel","hidessid","htmode"],dummyTip:function(){if(i=="rai0"){return"连接5G网络可以拥有更快的上网速度，实现低延时、高可靠、低功耗"}else{return}},clickButton:function(b){if(!b){return false}if(b.htmode==l.htmode&&b.hidessid==l.hidessid&&l.ssid==b.ssid&&l.key==b.password&&l.encryption==b.encryption&&l.channel==b.channel){$("#panel_wireless_"+i+"_"+i+" .error-text").show();$("#panel_wireless_"+i+"_"+i+" .error-text").text(L.tr("no-change-validation")).delay(3000).fadeOut(500);return false}if(b.encryption!="none"){if(b.password==""){$("#panel_wireless_"+i+"_"+i+" .error-text").show();$("#panel_wireless_"+i+"_"+i+" .error-text").text(L.tr("passwd-null-validation")).delay(3000).fadeOut(500);return false}if(b.password.length<8||b.password.length>64){$("#panel_wireless_"+i+"_"+i+" .error-text").show();$("#panel_wireless_"+i+"_"+i+" .error-text").text(L.tr("passwd-format-validation")).delay(3000).fadeOut(500);return false}}if(b.ssid==""){$("#panel_wireless_"+i+"_"+i+" .error-text").show();$("#panel_wireless_"+i+"_"+i+" .error-text").text(L.tr("ssid-format-validation")).delay(3000).fadeOut(500);return false}var a=new L.cbi.Modal("upgrade_prompt",{bodyText:L.tr("setting-now-validation"),});a.show();L.ui.sectionSave("saving",i);if(b.channel=="0"){b.channel="auto"}L.xapi.setWifi(l.type,"1",b.ssid,b.encryption,b.password,b.channel,"100",b.hidessid,b.htmode).then(function(c){setTimeout(function(){L.ui.popDialog(false);switch(c.status){case 0:l.ssid=b.ssid;l.key=b.password;l.encryption=b.encryption;l.channel=b.channel=="auto"?"0":b.channel;l.hidessid=b.hidessid;l.htmode=b.htmode;L.ui.sectionSave("saveS",i);break;case 17:case 18:case 19:L.ui.sectionSave("saveF",i);$("#panel_wireless_"+i+"_"+i+" .error-text").show();$("#panel_wireless_"+i+"_"+i+" .error-text").text(L.tr("save-wifi-ssid-same-fail-validation")).delay(3000).fadeOut(500);break;case 20:break;case 23:L.ui.sectionSave("saveF",i);$("#panel_wireless_"+i+"_"+i+" .error-text").show();$("#panel_wireless_"+i+"_"+i+" .error-text").text(L.tr("save-pwd-fail-validation")).delay(3000).fadeOut(500);break;default:L.ui.sectionSave("saveF",i);$("#panel_wireless_"+i+"_"+i+" .error-text").show();$("#panel_wireless_"+i+"_"+i+" .error-text").text(L.tr("save-fail-validation")).delay(3000).fadeOut(500)}setTimeout(function(){L.ui.sectionSave("close",i)},3000);return false},3000)})},switchState:l.enable,clickSwitch:function(){var b=false;var c=$(this);if(c.attr("name")!="ch"){b=true}if(l.channel=="0"){l.channel="auto"}if(b==true){var a=new L.cbi.Modal("wireless",{bodyText:L.tr("set-now-validation"),});a.show();h.openWifi(l);setTimeout(function(){L.ui.popDialog(false);h.switchDeal(c,true)},j)}else{if(l.type==0){L.xapi.getWifiInfo(1).then(function(d){if(d.data[0].enable=="1"){var e=new L.cbi.Modal("wireless",{title:L.tr("prompt-message"),footer:"both",bodyText:L.tr("2.4G-close-connect-visitor"),goingOn:function(){var f=new L.cbi.Modal("wireless",{bodyText:L.tr("set-now-validation"),});f.show();h.closeWifi(l,i);setTimeout(function(){L.ui.popDialog(false);h.switchDeal(c,true);h.switchDeal($("#section_switch_visitor"),false)},j);return false},stopGoing:function(){L.ui.popDialog(false);return false}});e.show()}else{var e=new L.cbi.Modal("wireless",{bodyText:L.tr("set-now-validation"),});e.show();h.closeWifi(l,i);setTimeout(function(){L.ui.popDialog(false);h.switchDeal(c,true)},j)}})}else{var a=new L.cbi.Modal("wireless",{bodyText:L.tr("set-now-validation"),});a.show();h.closeWifi(l,i);setTimeout(function(){L.ui.popDialog(false);h.switchDeal(c,true)},j)}}}});if(l.encryption!="none"&&l.encryption!="psk2"&&l.encryption!="psk+psk2"){l.encryption="psk+psk2"}n.option(L.cbi.InputValue,"ssid",{caption:L.tr("wireless-ssid"),inputText:l.ssid,datatype:"ssid",});n.option(L.cbi.HideSsidValue,"hidessid",{ssidHideState:l.hidessid,});n.option(L.cbi.CollapseValue,"__advance",{textC:L.tr("wireless-advance"),otherAbout:[i+"___advance",i+"_encryption",i+"_channel",i+"_htmode"],});n.option(L.cbi.ListValue,"encryption",{comeout:false,caption:L.tr("wireless-encryption"),otherAbout:[["psk2",i+"_password"],["mixed-psk",i+"_password"]],defaultT:l.encryption,}).value("none",L.tr("No encryption")).value("psk2",L.tr("WPA2 Personal (PSK)")).value("psk+psk2",L.tr("WPA/WPA2 Personal (PSK) mixed"));n.option(L.cbi.PasswordValue,"password",{caption:L.tr("wireless-password"),comeout:l.encryption!="none",inputText:l.key,datatype:"ssidPwd"});n.option(L.cbi.ErrorMsgValue,"error",{caption:L.tr(""),});if(i=="ra0"){n.option(L.cbi.ListValue,"htmode",{comeout:false,caption:L.tr("wireless-HT"),defaultT:l.htmode,}).value("0",L.tr("20/40MHz")).value("1",L.tr("40MHz"));n.option(L.cbi.ListValue,"channel",{caption:L.tr("wireless-channel"),comeout:false,defaultT:l.channel,}).value("0",L.tr("auto")).value("1",L.tr("1")).value("2",L.tr("2")).value("3",L.tr("3")).value("4",L.tr("4")).value("5",L.tr("5")).value("6",L.tr("6")).value("7",L.tr("7")).value("8",L.tr("8")).value("9",L.tr("9")).value("10",L.tr("10")).value("11",L.tr("11")).value("12",L.tr("12")).value("13",L.tr("13"))}else{if(i=="rai0"){n.option(L.cbi.ListValue,"htmode",{comeout:false,caption:L.tr("wireless-HT"),defaultT:l.htmode,}).value("0",L.tr("20/40MHz")).value("1",L.tr("40MHz")).value("2",L.tr("80MHz"));n.option(L.cbi.ListValue,"channel",{caption:L.tr("wireless-channel"),comeout:false,defaultT:l.channel}).value("0",L.tr("auto")).value("36",L.tr("36")).value("40",L.tr("40")).value("44",L.tr("44")).value("48",L.tr("48")).value("52",L.tr("52")).value("56",L.tr("56")).value("60",L.tr("60")).value("64",L.tr("64")).value("149",L.tr("149")).value("153",L.tr("153")).value("157",L.tr("157")).value("161",L.tr("161")).value("165",L.tr("165"));n.option(L.cbi.TipsValue,"tips",{})}}n.reorderOption("ssid","hidessid","password","__advance","encryption","channel","htmode","error")},sectionCreateVisitor:function(k,m,i,l){var h=this;var j=10000;var n=k.section(L.cbi.DummySection,i,{caption:L.tr(m),trigger:true,buttonValue:L.tr("Save"),sectionWarn:l.type==0?L.tr("wireless-close-2.4G-view"):(l.type==2?L.tr("wireless-close-5G-view"):L.tr("wireless-close-visitor-view")),saveData:[i,"ssid","password","encryption"],dummyTip:L.tr("wireless-close-visitor-tip"),clickButton:function(b){if(!b){return false}if(l.ssid==b.ssid&&l.key==b.password&&l.encryption==b.encryption){$("#panel_wireless_"+i+"_"+i+" .error-text").show();$("#panel_wireless_"+i+"_"+i+" .error-text").text(L.tr("no-change-validation")).delay(3000).fadeOut(500);return false}if(b.encryption!="none"){if(b.password==""){$("#panel_wireless_"+i+"_"+i+" .error-text").show();$("#panel_wireless_"+i+"_"+i+" .error-text").text(L.tr("passwd-null-validation")).delay(3000).fadeOut(500);return false}if(b.password.length<8||b.password.length>64){$("#panel_wireless_"+i+"_"+i+" .error-text").show();$("#panel_wireless_"+i+"_"+i+" .error-text").text(L.tr("passwd-format-validation")).delay(3000).fadeOut(500);return false}}if(b.ssid==""){$("#panel_wireless_"+i+"_"+i+" .error-text").show();$("#panel_wireless_"+i+"_"+i+" .error-text").text(L.tr("ssid-format-validation")).delay(3000).fadeOut(500);return false}var a=new L.cbi.Modal("access-tip",{title:L.tr("prompt-message"),bodyText:L.tr("visitor-setting-tip"),footer:"both",stopGoing:function(){return},goingOn:function(){var c=new L.cbi.Modal("upgrade_prompt",{bodyText:L.tr("setting-now-validation"),});c.show();L.ui.sectionSave("saving",i);L.xapi.setWifi(l.type,"1",b.ssid,b.encryption,b.password,"auto","100","0","0").then(function(d){setTimeout(function(){L.ui.popDialog(false);switch(d.status){case 0:l.ssid=b.ssid;l.key=b.password;l.encryption=b.encryption;L.ui.sectionSave("saveS",i);break;case 17:case 18:case 19:L.ui.sectionSave("saveF",i);$("#panel_wireless_"+i+"_"+i+" .error-text").show();$("#panel_wireless_"+i+"_"+i+" .error-text").text(L.tr("save-wifi-ssid-same-fail-validation")).delay(3000).fadeOut(500);break;case 20:break;case 23:L.ui.sectionSave("saveF",i);$("#panel_wireless_"+i+"_"+i+" .error-text").show();$("#panel_wireless_"+i+"_"+i+" .error-text").text(L.tr("save-pwd-fail-validation")).delay(3000).fadeOut(500);break;default:L.ui.sectionSave("saveF",i);$("#panel_wireless_"+i+"_"+i+" .error-text").show();$("#panel_wireless_"+i+"_"+i+" .error-text").text(L.tr("save-fail-validation")).delay(3000).fadeOut(500)}setTimeout(function(){L.ui.sectionSave("close",i)},3000);return false},3000)})},});a.show()},switchState:l.enable,clickSwitch:function(){var c=$(this);var b=false;if(c.attr("name")!="ch"){b=true}if(b==true){L.xapi.getWifiInfo(0).then(function(d){if(d.data[0].enable=="0"){var e=new L.cbi.Modal("wireless",{title:L.tr("prompt-message"),footer:"both",bodyText:L.tr("visitor-open-connect-2.4G"),goingOn:function(){var f=new L.cbi.Modal("wireless",{bodyText:L.tr("set-now-validation"),});f.show();h.openWifi(l);setTimeout(function(){L.ui.popDialog(false);h.switchDeal(c,true);h.switchDeal($("#section_switch_ra0"),false)},j);return false},stopGoing:function(){L.ui.popDialog(false);return false}});e.show()}else{var e=new L.cbi.Modal("wireless",{bodyText:L.tr("set-now-validation"),});e.show();h.openWifi(l);setTimeout(function(){L.ui.popDialog(false);h.switchDeal(c,true)},j)}})}else{var a=new L.cbi.Modal("wireless",{bodyText:L.tr("set-now-validation"),});a.show();h.closeWifi(l,i);setTimeout(function(){L.ui.popDialog(false);h.switchDeal(c,true)},j)}}});n.option(L.cbi.InputValue,"ssid",{caption:L.tr("wireless-ssid"),inputText:l.ssid,datatype:"ssid",});n.option(L.cbi.PasswordValue,"password",{caption:L.tr("wireless-password"),comeout:l.encryption!="none",inputText:l.key,datatype:"ssidPwd"});n.option(L.cbi.ListValue,"encryption",{caption:L.tr("wireless-encryption"),otherAbout:[["psk2",i+"_password"],["mixed-psk",i+"_password"]],defaultT:l.encryption,}).value("none",L.tr("No encryption")).value("psk2",L.tr("WPA2 Personal (PSK)")).value("psk+psk2",L.tr("WPA/WPA2 Personal (PSK) mixed"));n.option(L.cbi.ErrorMsgValue,"error",{caption:L.tr(""),});n.reorderOption("ssid","password","encryption","error")},getWifiInfo:function(c){var d=this;return L.xapi.getWifiInfo(c).then(function(j){var l=new L.cbi.Map("wireless",{pageaction:false});var b,a;for(var k=0;k<j.data.length;k++){var i=j.data[k];switch(i.type){case 0:b=L.tr("wireless-2.4G-title");a="ra0";d.sectionCreate(l,b,a,i);return l.insertInto("#map1");break;case 1:b=L.tr("wireless-visitor-title");a="visitor";d.sectionCreateVisitor(l,b,a,i);return l.insertInto("#map3");break;case 2:b=L.tr("wireless-5G-title");a="rai0";d.sectionCreate(l,b,a,i);return l.insertInto("#map2");break;default:}}})},execute:function(){var b=this;b.getWifiInfo(0);b.getWifiInfo(2);b.getWifiInfo(1)}});